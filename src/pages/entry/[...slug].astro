---
import EntryLayout from '../../layouts/EntryLayout.astro';
import EntryCard from '../../components/EntryCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const allEntries = await getCollection('entries');
  const published = allEntries
    .filter(({ data }) => !data.draft)
    .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime());

  return allEntries.map((entry) => {
    // For prev/next, only link to published entries
    const pubIndex = published.findIndex((e) => e.id === entry.id);
    const isPublished = pubIndex !== -1;

    return {
      params: { slug: entry.id },
      props: {
        entry,
        prev: isPublished && pubIndex > 0 ? published[pubIndex - 1] : null,
        next: isPublished && pubIndex < published.length - 1 ? published[pubIndex + 1] : null,
      },
    };
  });
}

const { entry, prev, next } = Astro.props;
---

<EntryLayout entry={entry} prev={prev} next={next}>
  <EntryCard entry={entry} />
</EntryLayout>
